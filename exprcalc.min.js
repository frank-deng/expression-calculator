!function(e,r){"use strict";"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?module.exports=r():e.Calc=r()}(this,function(){"use strict";var e=[function(e){return!!/^(\-\-)/g.exec(e)&&{type:0}},function(e){var r=/^0x[0-9A-Fa-f]+/g.exec(e);return r?{type:1,value:r[0]}:!!(r=/^[0-9]+(\.[0-9]+)?([Ee][+\-][0-9]+)?/g.exec(e))&&{type:1,value:r[0]}},function(e){var r=/^[A-Za-z_\u0080-\uffff][A-Za-z0-9_\u0080-\uffff]*/g.exec(e);return!!r&&{type:2,value:r[0]}},function(e){var r=/^[+\-\*\/\(\)]/g.exec(e);return!!r&&{type:3,value:r[0]}},function(e){var r=/^\s+/g.exec(e);return!!r&&{type:null,value:r[0]}}],r={"+":{binocular:!0,priority:10,processor:function(e,r){return e+r}},"-":{binocular:!0,priority:10,processor:function(e,r){return e-r}},"*":{binocular:!0,priority:20,processor:function(e,r){return e*r}},"/":{binocular:!0,priority:20,processor:function(e,r){return e/r}},NEG:{binocular:!1,priority:50,processor:function(e){return-e}}},t={START:["N","S","("],N:["B",")","END"],S:["N","("],B:["N","(","S"],"(":["S","N","("],")":[")","B","END"]},n=Error.prototype,o=function(e,r){this.name="SyntaxError",this.message=e,this.stack=(new Error).stack,this.token=r},u=o.prototype;u=Object.create(n),u.constructor=o;var i=function(e,r){this.name="RPNError",this.message=e,this.stack=(new Error).stack,this.token=r},a=i.prototype;a=Object.create(n),a.constructor=i;var p=function(r){for(var t,n=[],u=0;r.length;){for(var i=0;i<e.length;i++)if(!1!==(t=e[i](r))){if(0==t.type)throw new o("Unexpected Character",u);null!==t.type&&(t.pos=u,n.push(t)),u+=t.value.length,r=r.slice(t.value.length);break}if(!t)throw new o("Unexpected Character",u)}return n},l=function(e){return 1==e.type||2==e.type?"N":3==e.type?"("==e.value?"(":")"==e.value?")":r[e.value].binocular?"B":"S":null},s=function(e){for(var r,n="START",u=new Array,i=0;i<e.length;i++){var a=e[i];if(3==a.type&&"-"==a.value&&["N",")"].indexOf(n)<0&&(a.value=e[i].value="NEG"),r=l(a),t[n].indexOf(r)<0)throw new o("Unexpected Token",a);if("("==r)u.push(e[i]);else if(")"==r){if(0==u.length)throw new o("Unmatched Bracket",a);u.pop()}n=r}if(t[n].indexOf("END")<0)throw new o("Unexpected End Of Expression");if(u.length>0)throw new o("Unmatched Bracket",u[u.length-1])},f=function(e){for(var t,n=new Array,o=new Array,u=0;u<e.length;u++){var i=e[u];if(delete i.pos,1==i.type)i.value=Number(i.value),n.push(i);else if(2==i.type)n.push(i);else if(3==i.type)if(0==o.length||"("==i.value)o.push(i);else if(")"==i.value)for(;(t=o.pop())&&"("!=t.value;)n.push(t);else{for(;o.length>0&&"("!=o[o.length-1].value&&r[o[o.length-1].value].priority>=r[i.value].priority;)n.push(o.pop());o.push(i)}}for(;t=o.pop();)n.push(t);return n},c=function(e){for(var t=new Array,n=0;n<e.length;n++){var o=e[n];if(3==o.type){var u=r[o.value];if(u.binocular&&t.length>1&&1==t[t.length-1].type&&1==t[t.length-2].type){var i=t.pop().value,a=t.pop().value;t.push({type:1,value:u.processor(a,i)})}else!u.binocular&&t.length>0&&1==t[t.length-1].type?t.push({type:1,value:u.processor(t.pop().value)}):t.push(o)}else t.push(o)}return t},v=function(){var e=void 0;this.compile=function(r,t){var n=p(r);return s(n),e=f(n),t&&(e=c(e)),this},this.getRPN=function(){return e},this.setRPN=function(t){e=new Array;for(var n=0,o=0;o<t.length;o++){var u=t[o];if(1==u.type){if(isNaN(u.value))throw e=void 0,new i("Invalid Number",u);u.value=Number(u.value),n++}else if(2==u.type){if("string"!=typeof u.value)throw e=void 0,new i("Invalid Variable",u);n++}else{if(3!=u.type)throw e=void 0,new i("Invalid Token",u);var a=r[u.value];if(void 0===a)throw e=void 0,new i("Invalid Operand",u);if(a.binocular){if(n<=1)throw e=void 0,new i("Unexpected Operand",u);n--}else if(0==n)throw e=void 0,new i("Unexpected Operand",u)}e.push({type:u.type,value:u.value})}if(1!=n)throw e=void 0,new i("Invalid RPN",u);return 0==e.length&&(e=void 0),this},this.calc=function(t){if(void 0===e)return!1;for(var n=new Array,o=0;o<e.length;o++){var u=e[o];if(1==u.type)n.push(u.value);else if(2==u.type)void 0===t||isNaN(t[u.value])?n.push(0):n.push(Number(t[u.value]));else if(3==u.type){var i=r[u.value];if(i.binocular){var a=n.pop(),p=n.pop();n.push(i.processor(p,a))}else n.push(i.processor(n.pop()))}}return n[0]}};return v.SyntaxError=o,v.RPNError=i,v.TOKEN_NUM=1,v.TOKEN_VAR=2,v.TOKEN_OPER=3,v});